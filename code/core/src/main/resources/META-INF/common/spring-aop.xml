<?xml version="1.0" encoding="UTF-8"?>

<beans
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns="http://www.springframework.org/schema/beans"
	xmlns:aop="http://www.springframework.org/schema/aop"
	xmlns:util="http://www.springframework.org/schema/util"
	xmlns:property="http://www.springframework.org/schema/p"
	xmlns:transaction="http://www.springframework.org/schema/tx"
	xmlns:context="http://www.springframework.org/schema/context"

	xsi:schemaLocation="
			http://www.springframework.org/schema/beans
            http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
			http://www.springframework.org/schema/aop
            http://www.springframework.org/schema/aop/spring-aop-3.0.xsd
            http://www.springframework.org/schema/util
            http://www.springframework.org/schema/util/spring-util.xsd
            http://www.springframework.org/schema/context
            http://www.springframework.org/schema/context/spring-context-3.0.xsd">
            
	<description>
		This file is not to be modified by users generally.
		This is the configuration for the interceptor for the rules, the enrichment 
		interceptor for enriching the indexes with the geospatial data and the monitoring 
		interceptor that will collect statistical data in production.
	</description>
	
	<aop:aspectj-autoproxy proxy-target-class="true" />
	
	<bean 
		id="ikube.action.rule.IRuleInterceptor" 
		class="ikube.action.rule.RuleInterceptor"
		property:dataBase-ref="ikube.database.IDataBase"
		property:clusterManager-ref="ikube.cluster.IClusterManager" />
	<aop:config proxy-target-class="true">
		<aop:aspect ref="ikube.action.rule.IRuleInterceptor">
			<aop:around method="decide" pointcut="execution(* ikube.action.*.*(..))"  />
		</aop:aspect>
	</aop:config>
	
	<!-- 
		This bean is the geocoder, it will enrich the data with spatial co-ordinates if
		the indexables contain address fields. The Url for this service  
	-->
	<bean
		id="ikube.index.spatial.geocode.Geocoder"
		class="ikube.index.spatial.geocode.Geocoder"
		property:searchFields-ref="geospatialFields" 
		property:searchUrl="http://ikube.dyndns.org:8081/ikube/service/ISearcherWebService?wsdl" />
	<util:list id="geospatialFields">
		<value>name</value>
	</util:list>
	<bean 
		id="ikube.index.spatial.enrich.IEnrichment"
		class="ikube.index.spatial.enrich.Enrichment"
		property:minKm="10"
		property:maxKm="20"  />
	<bean 
		id="ikube.index.spatial.ISpatialEnrichmentInterceptor" 
		class="ikube.index.spatial.SpatialEnrichmentInterceptor"
		property:geocoder-ref="ikube.index.spatial.geocode.Geocoder"
		property:enrichment-ref="ikube.index.spatial.enrich.IEnrichment" />
	<aop:config proxy-target-class="true">
		<aop:aspect ref="ikube.index.spatial.ISpatialEnrichmentInterceptor">
			<aop:around method="enrich" pointcut="execution(* ikube.index.handler.DocumentDelegate.addDocument(..))" />
		</aop:aspect>
	</aop:config>
	
	<bean 
		id="ikube.monitoring.IMonitoringInterceptor" 
		name="ikube.monitoring.IMonitoringInterceptor"
		class="ikube.monitoring.MonitoringInterceptor"
		property:dataBase-ref="ikube.database.IDataBase" />
	<aop:config proxy-target-class="true">
		<aop:aspect ref="ikube.monitoring.IMonitoringInterceptor">
			<aop:around method="searchingPerformance" pointcut="execution(* ikube.service.SearchDelegate.execute(..))" />
		</aop:aspect>
		<aop:aspect ref="ikube.monitoring.IMonitoringInterceptor">
			<aop:around method="indexingPerformance" pointcut="execution(* ikube.index.handler.DocumentDelegate.addDocument(..))" />
		</aop:aspect>
	</aop:config>
	
</beans>
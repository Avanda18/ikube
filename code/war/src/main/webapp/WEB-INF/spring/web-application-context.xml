<beans xmlns="http://www.springframework.org/schema/beans" 
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
	xmlns:p="http://www.springframework.org/schema/p"
	xmlns:mvc="http://www.springframework.org/schema/mvc"
	xmlns:context="http://www.springframework.org/schema/context"
	
	xsi:schemaLocation="
		http://www.springframework.org/schema/beans 
		http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
		http://www.springframework.org/schema/mvc 
        http://www.springframework.org/schema/mvc/spring-mvc-3.0.xsd
		http://www.springframework.org/schema/context
		http://www.springframework.org/schema/context/spring-context-3.0.xsd">

	<context:property-placeholder
		location="**/spring.properties" 
		properties-ref="ikube.toolkit.PropertyConfigurer" />

	<!-- This bean will look through the classpath and load every Spring properties file it finds. -->
	<bean
		id="ikube.toolkit.PropertyConfigurer"
		class="ikube.toolkit.PropertyConfigurer"
		p:fileNamePattern="spring.properties"
		lazy-init="false"
		init-method="initialize" />

	<!-- External file system resources. -->
	<import resource="file:**/spring-*.xml" />
	
	<!-- Classpath resources. -->
	<!-- <import resource="/**/spring*.xml" /> -->
	<!-- <import resource="classpath*:**/spring*.xml" /> -->
	<!-- <import resource="classpath*:/**/spring*.xml" /> -->
	
	<context:annotation-config />
	<context:component-scan base-package="ikube" />
	<mvc:annotation-driven />
	
	<!-- Issue here with the spring.handlers files in the jars. -->
	<!-- <mvc:resources mapping="/js/**" location="/js/" />
	<mvc:resources mapping="/style/**" location="/style/" />
	<mvc:resources mapping="/images/**" location="/images/" /> -->
	
	<bean class="ikube.toolkit.ApplicationContextManager" />
	<bean class="org.springframework.web.servlet.mvc.annotation.DefaultAnnotationHandlerMapping" />
    <bean class="org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerAdapter" />
    <bean class="org.springframework.web.servlet.mvc.SimpleControllerHandlerAdapter" />
    
	<!-- This configures the tiles container. -->
	<bean 
		id="tilesConfigurer" 
		class="org.springframework.web.servlet.view.tiles2.TilesConfigurer" 
		p:definitions="/WEB-INF/tiles-defs/templates.xml" />

	<!-- This is the first handler that will be invoked by the dispatcher servlet. -->
	<bean 
		id="org.springframework.web.servlet.handler.SimpleUrlHandlerMapping" 
		class="org.springframework.web.servlet.handler.SimpleUrlHandlerMapping"
		p:order="1">
		<property name="mappings">
			<props>
				<prop key="/results.html">ikube.web.admin.SearchController</prop>
				<prop key="/admin/server.html">ikube.web.admin.ServerController</prop>
				<prop key="/admin/servers.html">ikube.web.admin.ServersController</prop>
				<prop key="/admin/logging.html">ikube.web.admin.LoggingController</prop>
				<prop key="/admin/index.html">ikube.web.admin.IndexController</prop>
				<prop key="/admin/search.html">ikube.web.admin.SearchIndexController</prop>
			</props>
		</property>
	</bean>

	<!-- 
		This is the second handler that will be called after the controller and will finally 
		resolve the view, i.e. it will wire the templates together and forward to the correct page. 
	-->
	<bean 
		id="vewResolver" 
		class="org.springframework.web.servlet.view.UrlBasedViewResolver" 
		p:order="2"
		p:suffix=".jsp"
		p:prefix="/WEB-INF/jsp/" 
		p:viewClass="org.springbyexample.web.servlet.view.tiles2.DynamicTilesView" />

	<!-- The controllers for the various pages that do the access logic if necessary. -->
	<bean name="ikube.web.admin.SearchController" class="ikube.web.admin.SearchController" />
	<bean name="ikube.web.admin.ServerController" class="ikube.web.admin.ServerController" />
	<bean name="ikube.web.admin.ServersController" class="ikube.web.admin.ServersController" />
	<bean name="ikube.web.admin.LoggingController" class="ikube.web.admin.LoggingController" />
	<bean name="ikube.web.admin.IndexController" class="ikube.web.admin.IndexController" />
	<bean name="ikube.web.admin.SearchIndexController" class="ikube.web.admin.SearchIndexController" />

	<!-- These are static resources basically. -->
	<mvc:view-controller path="/index.html" />
	<mvc:view-controller path="/admin/admin.html" />
	<mvc:view-controller path="/documentation/index.html" />
	<mvc:view-controller path="/documentation/quickstart.html" />
	<mvc:view-controller path="/documentation/configuration.html" />
	<mvc:view-controller path="/documentation/searching.html" />
	<mvc:view-controller path="/documentation/extra.html" />
	<mvc:view-controller path="/documentation/clustering.html" />
	<mvc:view-controller path="/documentation/indexes.html" />
	<mvc:view-controller path="/documentation/tutorial.html" />

	<mvc:interceptors>
		<bean 
			class="org.springframework.web.servlet.i18n.LocaleChangeInterceptor"
			p:paramName="lang" />
		<!-- <bean id="messageHandler" class="com.truvo.cmp.server.web.interceptor.MessageHandlerInterceptor" /> -->
	</mvc:interceptors>

	<bean 
		id="localeResolver" 
		class="org.springframework.web.servlet.i18n.CookieLocaleResolver"
		p:cookieName="lang"
		p:cookieMaxAge="604800" />
	
	<!-- Configure the multipart resolver -->
	<bean 
		id="multipartResolver" 
		class="org.springframework.web.multipart.commons.CommonsMultipartResolver" 
		p:maxUploadSize="10000000" />

</beans>
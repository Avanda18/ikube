<project name="Deploy Ikube to Cluster" default="deploy.war">

	<property file="build.properties" />
	<property name="ikube.dir" value="ikube-war-${project.version}" />
	<property name="ikube.war" value="ikube-war-${project.version}.war" />
	<property name="indexes" value="indexes" />
	
	<target name="deploy.war">
		<delete dir="${indexes.directory}" failonerror="false" />
		
		<delete dir="${tomcat.webapps}/${ikube.dir}" failonerror="true" />
		<delete dir="${tomcat.1.webapps}/${ikube.dir}" failonerror="true" />
		<delete dir="${tomcat.2.webapps}/${ikube.dir}" failonerror="true" />
		<delete dir="${tomcat.3.webapps}/${ikube.dir}" failonerror="true" />
		<delete dir="${tomcat.vm.one.webapps}/${ikube.dir}" failonerror="false" />
		<!-- delete dir="${tomcat.ikube.webapps}/${ikube.dir}" failonerror="true" / -->

		<delete dir="${cluster.directory}/indexes" failonerror="true" />
		<delete file="${cluster.directory}/ikube.log" failonerror="true" />
		<delete file="${cluster.directory}/ikube.odb" failonerror="true" />
		
		<delete dir="${tomcat.bin}/${indexes}" failonerror="true" />
		<delete dir="${tomcat.1.bin}/${indexes}" failonerror="true" />
		<delete dir="${tomcat.2.bin}/${indexes}" failonerror="true" />
		<delete dir="${tomcat.3.bin}/${indexes}" failonerror="true" />
		<delete file="${tomcat.vm.one.bin}/${indexes}" failonerror="false" />

		<delete file="${tomcat.webapps}/${ikube.war}" failonerror="true" />
		<delete file="${tomcat.1.webapps}/${ikube.war}" failonerror="true" />
		<delete file="${tomcat.2.webapps}/${ikube.war}" failonerror="true" />
		<delete file="${tomcat.3.webapps}/${ikube.war}" failonerror="true" />
		<delete file="${tomcat.vm.one.webapps}/${ikube.war}" failonerror="false" />
		<!-- delete file="${tomcat.ikube.webapps}/${ikube.war}" failonerror="true" / -->

		<copy file="${target.directory}/${ikube.war}" todir="${tomcat.webapps}" overwrite="true" failonerror="true" />
		<copy file="${target.directory}/${ikube.war}" todir="${tomcat.1.webapps}" overwrite="true" failonerror="true" />
		<copy file="${target.directory}/${ikube.war}" todir="${tomcat.2.webapps}" overwrite="true" failonerror="true" />
		<copy file="${target.directory}/${ikube.war}" todir="${tomcat.3.webapps}" overwrite="true" failonerror="true" />
		<copy file="${target.directory}/${ikube.war}" todir="${tomcat.vm.one.webapps}" overwrite="true" failonerror="false" />
		<!-- copy file="${target.directory}/${ikube.war}" todir="${tomcat.ikube.webapps}" overwrite="true" failonerror="true" / -->
		
	</target>
	
	<target name="cluster">
		<exec spawn="true" executable="${cluster.directory}/startup.bat" />
	</target>
	
	<target name="startCluster">
		<antcall target="startOne" />
		<antcall target="startTwo" />
		<antcall target="startThree" />
	</target>

	<target name="startOne">
		<java jar="${tomcat.1.bin}/bootstrap.jar" dir="${tomcat.1.bin}" fork="yes" spawn="true">
			<jvmarg value="-Dcatalina.home=${tomcat.1}" />
		</java>
	</target>
	<target name="startTwo">
		<java jar="${tomcat.2.bin}/bootstrap.jar" dir="${tomcat.2.bin}" fork="yes" spawn="true">
			<jvmarg value="-Dcatalina.home=${tomcat.2}" />
		</java>
	</target>
	<target name="startThree">
		<java jar="${tomcat.3.bin}/bootstrap.jar" dir="${tomcat.3.bin}" fork="yes" spawn="true">
			<jvmarg value="-Dcatalina.home=${tomcat.3}" />
		</java>
	</target>

	<target name="startTomcat">
		<exec executable="bash" os="Windows">
			<arg value="${tomcat.1.bin}/startup.bat" />
		</exec>
	</target>

	<target name="stopTomcat">
		<exec executable="bash" os="Windows">
			<arg value="${tomcat.1.bin}/shutdown.bat" />
		</exec>
	</target>

	<target name="stop">
		<exec spawn="true" executable="${tomcat.1.bin}/shutdown.bat" />
	</target>

</project>